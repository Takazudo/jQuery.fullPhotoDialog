/*! jQuery.fullPhotoDialog (https://github.com/Takazudo/jQuery.fullPhotoDialog)
 * lastupdate: 2013-07-08
 * version: 0.0.0
 * author: 'Takazudo' Takeshi Takatsudo <takazudo@gmail.com>
 * License: MIT */
(function(){(function(t,i){var o,e;return o=t(i),e={},e.options={},e.options.spinner={color:"#fff",width:2,lines:15,length:12,radius:20},e.options.src_dialog='<div class="ui-fullphotodialog">\n  <p class="ui-fullphotodialog-close"><a class="apply-domwindow-close" href="#">Ã—</a></p>\n  <div class="ui-fullphotodialog-gallery">\n    <div class="ui-fullphotodialog-gallery-inner">\n      ___xxx___ITEMSSRC___xxx___\n    </div>\n  </div>\n  <div class="ui-fullphotodialog-caption"></div>\n</div>',e.options.src_item='<div\n  data-fullphotodialog-caption="___xxx___CAPTION___xxx___"\n  data-fullphotodialog-src="___xxx___SRC___xxx___"\n  class="ui-fullphotodialog-galleryitem"\n></div>',e.winHeight=function(){return i.innerHeight||o.height()},e.winWidth=function(){return o.width()},e.tmpl=function(i,o){return t.each(o,function(t,o){var e;return e="___xxx___"+t.toUpperCase()+"___xxx___",i=i.replace(e,o)}),i},e.putOrAdjustImgInside=function(t){var i,o;return i=t.data("imgloaded")===!0,i?t.refreshImgContainRect():(o=t.attr("data-fullphotodialog-src"),t.imgContainRect({oninit:function(){return t.data("imgloaded",!0),new Spinner(e.options.spinner).spin(t[0])},src:o}))},e.FullPhotoDialog=function(){function n(){}return n.prototype.setup=function(){return this.steppyInstance=null,this.$steppyRoot=null,this.$caption=null,this.$dialog=t.ui.domwindowdialog.setup({fixedMinY:0,centeronresize:!0,centeronscroll:!0,tandbmargintodecideposition:0}),this._eventify()},n.prototype._eventify=function(){var t=this;return o.bind("resize orientationchange",function(){return t.$dialog.is(":visible")?(t.fitDialog(),t.updateSteppySize(),t.handleImgs()):void 0}),this},n.prototype.handleImgs=function(){var i,o;return i=this.$steppyRoot.find(".ui-fullphotodialog-galleryitem"),o=this.calcSteppySize(),i.each(function(i,o){return e.putOrAdjustImgInside(t(o))}),this},n.prototype.fitDialog=function(){return this.$dialog.css({width:e.winWidth(),height:e.winHeight()}),this},n.prototype.calcSteppySize=function(){var t,i;return i=e.winWidth(),t=e.winHeight(),t-=70,{width:i,height:t}},n.prototype.updateSteppySize=function(){var t;return t=this.calcSteppySize(),this.$steppyRoot.css({width:t.width,height:t.height,top:e.winHeight()/2-t.height/2}),this.$steppyRoot.find(".ui-fullphotodialog-galleryitem").css({width:t.width}),this.steppyInstance.updateOption({stepwidth:t.width}),this},n.prototype.updateCaption=function(t){var i;return i=this.$steppyRoot.find(".ui-fullphotodialog-galleryitem").eq(t).attr("data-fullphotodialog-caption"),this.$caption.text(i),this},n.prototype.initializeInside=function(t){var e=this;return t.on("touchmove",function(t){return t.preventDefault()}),this.$steppyRoot=t.find(".ui-fullphotodialog-gallery"),this.$caption=t.find(".ui-fullphotodialog-caption"),this.$steppyRoot.css({left:0,top:(i.innerHeight||o.height())/2}),this.$steppyRoot.touchdraghsteppy({inner:".ui-fullphotodialog-gallery-inner",item:".ui-fullphotodialog-galleryitem",stepwidth:300,widthbetween:20,maxindex:8,triggerrefreshimmediately:!1,alwayspreventtouchmove:!0}),this.steppyInstance=this.$steppyRoot.data("touchdraghsteppy"),this.steppyInstance.on("refresh indexchange",function(){return e.updateCaption(e.steppyInstance.currentIndex)}),this.updateSteppySize(),this.$steppyRoot.css({visibility:"visible"}),this.handleImgs(),this},n.prototype.open=function(t){var o,n=this;return o=this.createDialogSrc(t),i.domwindowApi.open(o,{strdialog:!0,width:e.winWidth(),height:e.winHeight(),afteropen:function(t,i){return n.initializeInside(i.dialog)},beforeclose:function(){var t,i;return t=null,i=null}}),this},n.prototype.createDialogSrc=function(i){var o,n;return o="",t.each(i,function(t,i){return o+=e.tmpl(e.options.src_item,i)}),n=e.tmpl(e.options.src_dialog,{itemsSrc:o})},n}(),t.FullPhotoDialogNs=e,t.fullPhotoDialog=new t.FullPhotoDialogNs.FullPhotoDialog})(jQuery,window,document)}).call(this);