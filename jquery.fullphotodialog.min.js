/*! jQuery.fullPhotoDialog (https://github.com/Takazudo/jQuery.fullPhotoDialog)
 * lastupdate: 2013-07-09
 * version: 0.0.0
 * author: 'Takazudo' Takeshi Takatsudo <takazudo@gmail.com>
 * License: MIT */
(function(){(function(t,i){var n,e;return n=t(i),e={},e.options={},e.options.spinner={color:"#fff",width:2,lines:15,length:12,radius:20},e.options.src_dialog='<div class="ui-fullphotodialog">\n  <div class="ui-fullphotodialog-close"><a class="apply-domwindow-close" href="#">Ã—</a></div>\n  <a class="ui-fullphotodialog-openblank" href="#" target="_blank">OPEN</a>\n  <div class="ui-fullphotodialog-gallery">\n    <div class="ui-fullphotodialog-gallery-inner">\n      ___xxx___ITEMSSRC___xxx___\n    </div>\n  </div>\n  <div class="ui-fullphotodialog-caption"></div>\n</div>',e.options.src_item='<div\n  data-fullphotodialog-caption="___xxx___CAPTION___xxx___"\n  data-fullphotodialog-src="___xxx___SRC___xxx___"\n  class="ui-fullphotodialog-galleryitem"\n></div>',e.winHeight=function(){return i.innerHeight||n.height()},e.winWidth=function(){return n.width()},e.tmpl=function(i,n){return t.each(n,function(t,n){var e;return e="___xxx___"+t.toUpperCase()+"___xxx___",i=i.replace(e,n)}),i},e.putOrAdjustImgInside=function(t){var i,n;return i=t.data("imgloaded")===!0,i?t.refreshImgContainRect():(n=t.attr("data-fullphotodialog-src"),t.imgContainRect({cloneImg:!1,oninit:function(){return t.data("imgloaded",!0),new Spinner(e.options.spinner).spin(t[0])},src:n}))},e.FullPhotoDialog=function(){function o(){}return o.prototype.setup=function(){return this.steppyInstance=null,this.$steppyRoot=null,this.$caption=null,this.$dialog=t.ui.domwindowdialog.setup({fixedMinY:0,centeronresize:!0,centeronscroll:!0,tandbmargintodecideposition:0}),this._eventify()},o.prototype._eventify=function(){var t=this;return n.bind("resize orientationchange",function(){return t.$dialog.is(":visible")?(t.fitDialog(),t.updateSteppySize(),t.handleImgs()):void 0}),this},o.prototype.handleImgs=function(){var i,n;return i=this.$steppyRoot.find(".ui-fullphotodialog-galleryitem"),n=this.calcSteppySize(),i.each(function(i,n){return e.putOrAdjustImgInside(t(n))}),this},o.prototype.fitDialog=function(){return this.$dialog.css({width:e.winWidth(),height:e.winHeight()}),this},o.prototype.calcSteppySize=function(){var t,i;return i=e.winWidth(),t=e.winHeight(),t-=70,{width:i,height:t}},o.prototype.updateSteppySize=function(){var t;return t=this.calcSteppySize(),this.$steppyRoot.css({width:t.width,height:t.height,top:e.winHeight()/2-t.height/2}),this.$steppyRoot.find(".ui-fullphotodialog-galleryitem").css({width:t.width}),this.steppyInstance.updateOption({stepwidth:t.width}),this},o.prototype.updateCaption=function(t){var i;return i=this.$steppyRoot.find(".ui-fullphotodialog-galleryitem").eq(t).attr("data-fullphotodialog-caption"),this.$caption.text(i),this},o.prototype.attachCurrentImgLink=function(t){var i;return i=this.itemsData[this.steppyInstance.currentIndex],t.attr("href",i.src),this},o.prototype.initializeInside=function(e){var o=this;return e.on("click",".ui-fullphotodialog-openblank",function(i){var n;return n=t(i.currentTarget),o.attachCurrentImgLink(n)}),e.on("touchmove",function(t){return t.preventDefault()}),this.$steppyRoot=e.find(".ui-fullphotodialog-gallery"),this.$caption=e.find(".ui-fullphotodialog-caption"),this.$steppyRoot.css({left:0,top:(i.innerHeight||n.height())/2}),this.$steppyRoot.touchdraghsteppy({inner:".ui-fullphotodialog-gallery-inner",item:".ui-fullphotodialog-galleryitem",stepwidth:300,widthbetween:20,maxindex:8,triggerrefreshimmediately:!1,alwayspreventtouchmove:!0}),this.steppyInstance=this.$steppyRoot.data("touchdraghsteppy"),this.steppyInstance.on("refresh indexchange",function(){return o.updateCaption(o.steppyInstance.currentIndex)}),this.updateSteppySize(),this.$steppyRoot.css({visibility:"visible"}),this.handleImgs(),this},o.prototype.open=function(t){var n,o=this;return this.itemsData=t,n=this.createDialogSrc(t),i.domwindowApi.open(n,{strdialog:!0,width:e.winWidth(),height:e.winHeight(),afteropen:function(t,i){return o.initializeInside(i.dialog)},beforeclose:function(){var t,i;return t=null,i=null}}),this},o.prototype.createDialogSrc=function(i){var n,o;return n="",t.each(i,function(t,i){return n+=e.tmpl(e.options.src_item,i)}),o=e.tmpl(e.options.src_dialog,{itemsSrc:n})},o}(),t.FullPhotoDialogNs=e,t.fullPhotoDialog=new t.FullPhotoDialogNs.FullPhotoDialog})(jQuery,window,document)}).call(this);