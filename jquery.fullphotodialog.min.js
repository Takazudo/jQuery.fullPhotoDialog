/*! jQuery.fullPhotoDialog (https://github.com/Takazudo/jQuery.fullPhotoDialog)
 * lastupdate: 2013-05-21
 * version: 0.0.0
 * author: 'Takazudo' Takeshi Takatsudo <takazudo@gmail.com>
 * License: MIT */
(function(){var t=[].slice;(function(i,e){var n,o;return n=i(e),o={},o.options={},o.options.spinner={color:"#fff",width:2,lines:15,length:12,radius:20},o.options.src_dialog='<div class="ui-fullphotodialog">\n  <p class="ui-fullphotodialog-close"><a class="apply-domwindow-close" href="#">Ã—</a></p>\n  <div class="ui-fullphotodialog-gallery">\n    <div class="ui-fullphotodialog-gallery-inner">\n      ___xxx___ITEMSSRC___xxx___\n    </div>\n  </div>\n  <div class="ui-fullphotodialog-caption"></div>\n</div>',o.options.src_item='<div\n  data-fullphotodialog-caption="___xxx___CAPTION___xxx___"\n  data-fullphotodialog-src="___xxx___SRC___xxx___"\n  class="ui-fullphotodialog-galleryitem"\n></div>',o.winHeight=function(){return e.innerHeight||n.height()},o.winWidth=function(){return n.width()},o.tmpl=function(t,e){return i.each(e,function(i,e){var n;return n="___xxx___"+i.toUpperCase()+"___xxx___",t=t.replace(n,e)}),t},o.putOrAdjustImgInside=function(t,e,n){var l,s,r;return r=t.attr("data-fullphotodialog-src"),s=t.data("imgloaded")===!0,l={width:e,height:n},s||(t.empty(),new Spinner(o.options.spinner).spin(t[0])),i.imgUtil.calcRectFitImgWH(r,l).done(function(i){var e,o;return t.data("imgloaded",!0),e=i.img,setTimeout(function(){return t.empty().append(e)},10),o=void 0,o=n>i.height?Math.floor(n/2-i.height/2):0,e.css({width:i.width,height:i.height,marginTop:o})})},o.Event=function(){function i(){}return i.prototype.on=function(t,i){var e,n,o,l,s;for(null==this._callbacks&&(this._callbacks={}),e=t.split(" "),l=0,s=e.length;s>l;l++)n=e[l],(o=this._callbacks)[n]||(o[n]=[]),this._callbacks[n].push(i);return this},i.prototype.once=function(t,i){return this.on(t,function(){return this.off(t,arguments.callee),i.apply(this,arguments)}),this},i.prototype.trigger=function(){var i,e,n,o,l,s,r;if(i=arguments.length>=1?t.call(arguments,0):[],n=i.shift(),o=null!=(r=this._callbacks)?r[n]:void 0){for(l=0,s=o.length;s>l&&(e=o[l],e.apply(this,i)!==!1);l++);return this}},i.prototype.off=function(t,i){var e,n,o,l,s,r;if(!t)return this._callbacks={},this;if(o=null!=(r=this._callbacks)?r[t]:void 0,!o)return this;if(!i)return delete this._callbacks[t],this;for(n=l=0,s=o.length;s>l;n=++l)if(e=o[n],e===i){o=o.slice(),o.splice(n,1),this._callbacks[t]=o;break}return this},i}(),o.FullPhotoDialog=function(){function t(){}return t.prototype.setup=function(){return this.steppyInstance=null,this.$steppyRoot=null,this.$caption=null,this.$dialog=i.ui.domwindowdialog.setup({fixedMinY:0,centeronresize:!0,centeronscroll:!0,tandbmargintodecideposition:0}),this._eventify()},t.prototype._eventify=function(){var t=this;return n.bind("resize orientationchange",function(){return t.$dialog.is(":visible")?(t.fitDialog(),t.updateSteppySize(),t.handleImgs()):void 0}),this},t.prototype.handleImgs=function(){var t,e;return t=this.$steppyRoot.find(".ui-fullphotodialog-galleryitem"),e=this.calcSteppySize(),t.each(function(t,n){return o.putOrAdjustImgInside(i(n),e.width,e.height)}),this},t.prototype.fitDialog=function(){return this.$dialog.css({width:o.winWidth(),height:o.winHeight()}),this},t.prototype.calcSteppySize=function(){var t,i;return i=o.winWidth(),t=o.winHeight(),t-=70,{width:i,height:t}},t.prototype.updateSteppySize=function(){var t;return t=this.calcSteppySize(),this.$steppyRoot.css({width:t.width,height:t.height,top:o.winHeight()/2-t.height/2}),this.$steppyRoot.find(".ui-fullphotodialog-galleryitem").css({width:t.width}),this.steppyInstance.updateOption({stepwidth:t.width}),this},t.prototype.updateCaption=function(t){var i;return i=this.$steppyRoot.find(".ui-fullphotodialog-galleryitem").eq(t).attr("data-fullphotodialog-caption"),this.$caption.text(i),this},t.prototype.initializeInside=function(t){var i=this;return t.on("touchmove",function(t){return t.preventDefault()}),this.$steppyRoot=t.find(".ui-fullphotodialog-gallery"),this.$caption=t.find(".ui-fullphotodialog-caption"),this.$steppyRoot.css({left:0,top:(e.innerHeight||n.height())/2}),this.$steppyRoot.touchdraghsteppy({inner:".ui-fullphotodialog-gallery-inner",item:".ui-fullphotodialog-galleryitem",stepwidth:300,widthbetween:20,maxindex:8,triggerrefreshimmediately:!1,alwayspreventtouchmove:!0}),this.steppyInstance=this.$steppyRoot.data("touchdraghsteppy"),this.steppyInstance.on("refresh indexchange",function(){return i.updateCaption(i.steppyInstance.currentIndex)}),this.updateSteppySize(),this.$steppyRoot.css({visibility:"visible"}),this.handleImgs(),this},t.prototype.open=function(t){var i,n=this;return i=this.createDialogSrc(t),e.domwindowApi.open(i,{strdialog:!0,width:o.winWidth(),height:o.winHeight(),afteropen:function(t,i){return n.initializeInside(i.dialog)},beforeclose:function(){var t,i;return t=null,i=null}}),this},t.prototype.createDialogSrc=function(t){var e,n;return e="",i.each(t,function(t,i){return e+=o.tmpl(o.options.src_item,i)}),n=o.tmpl(o.options.src_dialog,{itemsSrc:e})},t}(),i.FullPhotoDialogNs=o,i.fullPhotoDialog=new i.FullPhotoDialogNs.FullPhotoDialog})(jQuery,window,document)}).call(this);