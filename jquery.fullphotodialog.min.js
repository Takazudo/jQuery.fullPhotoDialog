/*! jQuery.fullPhotoDialog (https://github.com/Takazudo/jQuery.fullPhotoDialog)
 * lastupdate: 2013-05-25
 * version: 0.0.0
 * author: 'Takazudo' Takeshi Takatsudo <takazudo@gmail.com>
 * License: MIT */
(function(){var t=[].slice;(function(i,n){var e,o;return e=i(n),o={},o.options={},o.options.spinner={color:"#fff",width:2,lines:15,length:12,radius:20},o.options.src_dialog='<div class="ui-fullphotodialog">\n  <p class="ui-fullphotodialog-close"><a class="apply-domwindow-close" href="#">Ã—</a></p>\n  <div class="ui-fullphotodialog-gallery">\n    <div class="ui-fullphotodialog-gallery-inner">\n      ___xxx___ITEMSSRC___xxx___\n    </div>\n  </div>\n  <div class="ui-fullphotodialog-caption"></div>\n</div>',o.options.src_item='<div\n  data-fullphotodialog-caption="___xxx___CAPTION___xxx___"\n  data-fullphotodialog-src="___xxx___SRC___xxx___"\n  class="ui-fullphotodialog-galleryitem"\n></div>',o.winHeight=function(){return n.innerHeight||e.height()},o.winWidth=function(){return e.width()},o.tmpl=function(t,n){return i.each(n,function(i,n){var e;return e="___xxx___"+i.toUpperCase()+"___xxx___",t=t.replace(e,n)}),t},o.putOrAdjustImgInside=function(t){var i,n;return i=t.data("imgloaded")===!0,i?t.refreshImgContainRect():(n=t.attr("data-fullphotodialog-src"),t.imgContainRect({oninit:function(){return t.data("imgloaded",!0),new Spinner(o.options.spinner).spin(t[0])},src:n}))},o.Event=function(){function i(){}return i.prototype.on=function(t,i){var n,e,o,l,s;for(null==this._callbacks&&(this._callbacks={}),n=t.split(" "),l=0,s=n.length;s>l;l++)e=n[l],(o=this._callbacks)[e]||(o[e]=[]),this._callbacks[e].push(i);return this},i.prototype.once=function(t,i){return this.on(t,function(){return this.off(t,arguments.callee),i.apply(this,arguments)}),this},i.prototype.trigger=function(){var i,n,e,o,l,s,r;if(i=arguments.length>=1?t.call(arguments,0):[],e=i.shift(),o=null!=(r=this._callbacks)?r[e]:void 0){for(l=0,s=o.length;s>l&&(n=o[l],n.apply(this,i)!==!1);l++);return this}},i.prototype.off=function(t,i){var n,e,o,l,s,r;if(!t)return this._callbacks={},this;if(o=null!=(r=this._callbacks)?r[t]:void 0,!o)return this;if(!i)return delete this._callbacks[t],this;for(e=l=0,s=o.length;s>l;e=++l)if(n=o[e],n===i){o=o.slice(),o.splice(e,1),this._callbacks[t]=o;break}return this},i}(),o.FullPhotoDialog=function(){function t(){}return t.prototype.setup=function(){return this.steppyInstance=null,this.$steppyRoot=null,this.$caption=null,this.$dialog=i.ui.domwindowdialog.setup({fixedMinY:0,centeronresize:!0,centeronscroll:!0,tandbmargintodecideposition:0}),this._eventify()},t.prototype._eventify=function(){var t=this;return e.bind("resize orientationchange",function(){return t.$dialog.is(":visible")?(t.fitDialog(),t.updateSteppySize(),t.handleImgs()):void 0}),this},t.prototype.handleImgs=function(){var t,n;return t=this.$steppyRoot.find(".ui-fullphotodialog-galleryitem"),n=this.calcSteppySize(),t.each(function(t,n){return o.putOrAdjustImgInside(i(n))}),this},t.prototype.fitDialog=function(){return this.$dialog.css({width:o.winWidth(),height:o.winHeight()}),this},t.prototype.calcSteppySize=function(){var t,i;return i=o.winWidth(),t=o.winHeight(),t-=70,{width:i,height:t}},t.prototype.updateSteppySize=function(){var t;return t=this.calcSteppySize(),this.$steppyRoot.css({width:t.width,height:t.height,top:o.winHeight()/2-t.height/2}),this.$steppyRoot.find(".ui-fullphotodialog-galleryitem").css({width:t.width}),this.steppyInstance.updateOption({stepwidth:t.width}),this},t.prototype.updateCaption=function(t){var i;return i=this.$steppyRoot.find(".ui-fullphotodialog-galleryitem").eq(t).attr("data-fullphotodialog-caption"),this.$caption.text(i),this},t.prototype.initializeInside=function(t){var i=this;return t.on("touchmove",function(t){return t.preventDefault()}),this.$steppyRoot=t.find(".ui-fullphotodialog-gallery"),this.$caption=t.find(".ui-fullphotodialog-caption"),this.$steppyRoot.css({left:0,top:(n.innerHeight||e.height())/2}),this.$steppyRoot.touchdraghsteppy({inner:".ui-fullphotodialog-gallery-inner",item:".ui-fullphotodialog-galleryitem",stepwidth:300,widthbetween:20,maxindex:8,triggerrefreshimmediately:!1,alwayspreventtouchmove:!0}),this.steppyInstance=this.$steppyRoot.data("touchdraghsteppy"),this.steppyInstance.on("refresh indexchange",function(){return i.updateCaption(i.steppyInstance.currentIndex)}),this.updateSteppySize(),this.$steppyRoot.css({visibility:"visible"}),this.handleImgs(),this},t.prototype.open=function(t){var i,e=this;return i=this.createDialogSrc(t),n.domwindowApi.open(i,{strdialog:!0,width:o.winWidth(),height:o.winHeight(),afteropen:function(t,i){return e.initializeInside(i.dialog)},beforeclose:function(){var t,i;return t=null,i=null}}),this},t.prototype.createDialogSrc=function(t){var n,e;return n="",i.each(t,function(t,i){return n+=o.tmpl(o.options.src_item,i)}),e=o.tmpl(o.options.src_dialog,{itemsSrc:n})},t}(),i.FullPhotoDialogNs=o,i.fullPhotoDialog=new i.FullPhotoDialogNs.FullPhotoDialog})(jQuery,window,document)}).call(this);