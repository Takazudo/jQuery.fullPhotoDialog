/*! jQuery.fullPhotoDialog (https://github.com/Takazudo/jQuery.fullPhotoDialog)
 * lastupdate: 2013-07-29
 * version: 0.0.0
 * author: 'Takazudo' Takeshi Takatsudo <takazudo@gmail.com>
 * License: MIT */
(function(){(function(t,i){var e,n;return e=t(i),n={},n.resizeCount=0,n.options={},n.options.spinner={color:"#fff",width:2,lines:15,length:12,radius:20},n.options.src_dialog='<div class="ui-fullphotodialog">\n  <div class="ui-fullphotodialog-close"><a class="apply-domwindow-close" href="#">Ã—</a></div>\n  <a class="ui-fullphotodialog-openblank" href="#" target="_blank">OPEN</a>\n  <div class="ui-fullphotodialog-gallery">\n    <div class="ui-fullphotodialog-gallery-inner">\n      ___xxx___ITEMSSRC___xxx___\n    </div>\n  </div>\n  <div class="ui-fullphotodialog-caption"></div>\n</div>',n.options.src_item='<div\n  data-fullphotodialog-caption="___xxx___CAPTION___xxx___"\n  data-fullphotodialog-src="___xxx___SRC___xxx___"\n  class="ui-fullphotodialog-galleryitem"\n></div>',n.browser={},n.browser.android=/android/i.test(navigator.userAgent),n.browser.android=!0,n.winHeight=function(){return i.innerHeight||e.height()},n.winWidth=function(){return e.width()},n.tmpl=function(i,e){return t.each(e,function(t,e){var n;return n="___xxx___"+t.toUpperCase()+"___xxx___",i=i.replace(n,e)}),i},n.putOrAdjustImgInside=function(t){var i,e;return i=t.data("imgloaded")===!0,i?t.refreshImgContainRect():(e=t.attr("data-fullphotodialog-src"),t.imgContainRect({cloneImg:!1,oninit:function(){return t.data("imgloaded",!0),new Spinner(n.options.spinner).spin(t[0])},src:e}))},n.FullPhotoDialog=function(){function o(){}return o.prototype.setup=function(){return this.steppyInstance=null,this.$steppyRoot=null,this.$caption=null,this.$dialog=t.ui.domwindowdialog.setup({fixedMinY:0,centeronresize:!0,centeronscroll:!0,tandbmargintodecideposition:0}),this._eventify()},o.prototype._eventify=function(){var t,i=this;return t=n.browser.android?function(e){var o;return o=n.resizeCount,i.$dialog.is(":visible")&&(i.fitDialog(),i.updateSteppySize(),i.handleImgs(),e)?setTimeout(function(){return n.resizeCount===o?t():void 0},500):void 0}:function(){return i.$dialog.is(":visible")?(i.fitDialog(),i.updateSteppySize(),i.handleImgs()):void 0},e.bind("resize orientationchange",function(){return n.resizeCount+=1,t(!0)}),this},o.prototype.handleImgs=function(){var i,e;return i=this.$steppyRoot.find(".ui-fullphotodialog-galleryitem"),e=this.calcSteppySize(),i.each(function(i,e){return n.putOrAdjustImgInside(t(e))}),this},o.prototype.fitDialog=function(){return this.$dialog.css({width:n.winWidth(),height:n.winHeight()}),this},o.prototype.calcSteppySize=function(){var t,i;return i=n.winWidth(),t=n.winHeight(),t-=70,{width:i,height:t}},o.prototype.updateSteppySize=function(){var t;return t=this.calcSteppySize(),this.$steppyRoot.css({width:t.width,height:t.height,top:n.winHeight()/2-t.height/2}),this.$steppyRoot.find(".ui-fullphotodialog-galleryitem").css({width:t.width}),this.steppyInstance.updateOption({stepwidth:t.width}),this},o.prototype.updateCaption=function(t){var i;return i=this.$steppyRoot.find(".ui-fullphotodialog-galleryitem").eq(t).attr("data-fullphotodialog-caption"),this.$caption.text(i),this},o.prototype.attachCurrentImgLink=function(t){var i;return i=this.itemsData[this.steppyInstance.currentIndex],t.attr("href",i.src),this},o.prototype.initializeInside=function(n){var o=this;return n.on("click",".ui-fullphotodialog-openblank",function(i){var e;return e=t(i.currentTarget),o.attachCurrentImgLink(e)}),n.on("touchmove",function(t){return t.preventDefault()}),this.$steppyRoot=n.find(".ui-fullphotodialog-gallery"),this.$caption=n.find(".ui-fullphotodialog-caption"),this.$steppyRoot.css({left:0,top:(i.innerHeight||e.height())/2}),this.$steppyRoot.touchdraghsteppy({inner:".ui-fullphotodialog-gallery-inner",item:".ui-fullphotodialog-galleryitem",stepwidth:300,widthbetween:20,maxindex:8,triggerrefreshimmediately:!1,alwayspreventtouchmove:!0}),this.steppyInstance=this.$steppyRoot.data("touchdraghsteppy"),this.steppyInstance.on("refresh indexchange",function(){return o.updateCaption(o.steppyInstance.currentIndex)}),this.updateSteppySize(),this.$steppyRoot.css({visibility:"visible"}),this.handleImgs(),this},o.prototype.open=function(t){var e,o=this;return this.itemsData=t,e=this.createDialogSrc(t),i.domwindowApi.open(e,{strdialog:!0,width:n.winWidth(),height:n.winHeight(),afteropen:function(t,i){return o.initializeInside(i.dialog)},beforeclose:function(){var t,i;return t=null,i=null}}),this},o.prototype.createDialogSrc=function(i){var e,o;return e="",t.each(i,function(t,i){return e+=n.tmpl(n.options.src_item,i)}),o=n.tmpl(n.options.src_dialog,{itemsSrc:e})},o}(),t.FullPhotoDialogNs=n,t.fullPhotoDialog=new t.FullPhotoDialogNs.FullPhotoDialog})(jQuery,window,document)}).call(this);